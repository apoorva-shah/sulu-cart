define([],function(){"use strict";var a={discount:0,currency:"EUR",taxRate:.2,locale:"en",unit:"pc"},b={invalidInputTranslation:"products.price-calculation.invalid.input"},c=function(a,b){return a.dom.isNumeric(b)?(b=parseFloat(b),!(isNaN(b)||!(b>=0))):!1},d=function(b,d){if(c(b,d))return parseFloat(d)/100;if(d)throw new Error("Invalid argument for tax rate ("+d+")!");return a.taxRate},e=function(a,d){if(c(a,d)&&parseFloat(d)<=100)return parseFloat(d)/100;if(d)throw new Error("Invalid argument for discount ("+d+")!");return parseFloat(b.discount)},f=function(b){return b?b:a.currency},g=function(b){return b?b:a.unit},h=function(b){return b?b:a.locale},i=function(a){return"en"!==a},j=function(a,b,d,e,f){return!a.dom.isNumeric(b)||!c(a,d)||parseFloat(d)>100||!c(a,e)||parseFloat(e)>100||!c(a,f)?(a.logger.error("Invalid parameter(s) for price calculation!"),!1):!0},k=function(a,b){var c=e(a,b.discount),d=parseFloat(b.price);return d*=b.quantity,c&&(d-=d*c),d},l=function(a,b,c,d){if(a.dom.isNumeric(c)&&0!=c){var e,f,g,h=0,i=0,l=m(b);for(var n in b)if(e=b[n],!e.isRecurringPrice){if(!j(a,e.price,e.tax,e.discount,e.quantity))return null;f=k(a,e),h=e.tax.toString(),i=0,0!=d.netPrice?i=f/d.netPrice:l>0&&(i=1/l),g=i*c*e.tax/100,d.taxes[h]+=g,d.grossPrice+=g}d.netPrice+=c,d.grossPrice+=c}},m=function(a){var b=0;for(var c in a){var d=a[c];d.isRecurringPrice||b++}return b},n=function(a,b,c,e){var f,g,h,i=0,m={taxes:{},netPrice:0,grossPrice:0};e=!!e,"undefined"==typeof c&&(c=0);try{for(f in b)if(g=b[f],g.isRecurringPrice===e){if(!j(a,g.price,g.tax,g.discount,g.quantity))return null;h=k(a,g),i=h*d(a,g.tax),m.taxes[g.tax]?m.taxes[g.tax]+=i:m.taxes[g.tax]=i,m.netPrice+=h,m.grossPrice+=h+i}return l(a,b,c,m),m}catch(n){return a.logger.error(n.message),null}};return{getFormattedGrossPrice:function(a,c,e,g){if(!j(a,c,g,0,0))return a.translate(b.invalidInputTranslation);var k,l;try{return c=parseFloat(c),g=d(a,g),e=f(e),l=h(a.globalize.getLocale()),k=c+c*g,this.getFormattedNumberWithAddition(a,k,e,i(l))}catch(m){return a.logger.error(m.message),a.translate(b.invalidInputTranslation)}},getFormattedNetPrice:function(a,c,e,g){if(!j(a,c,g,0,0))return a.translate(b.invalidInputTranslation);var k,l;return c=parseFloat(c),g=d(a,g),e=f(e),l=h(a.globalize.getLocale()),k=c-c*g,this.getFormattedNumberWithAddition(a,k,e,i(l))},getFormattedAmountAndUnit:function(a,c,d){return a.dom.isNumeric(c)?(d=g(d),this.getFormattedNumberWithAddition(a,c,d,!0)):(a.logger.error("Invalid parameter in getFormattedAmountAndUnit!"),a.translate(b.invalidInputTranslation))},getFormattedNumberWithAddition:function(a,b,c,d){var e=a.numberFormat(b,"n");return d?e+" "+c:c+""+e},getTotalPrice:function(a,c,g,k,l,m,n){if(!j(a,c,m,k,l))return a.translate(b.invalidInputTranslation);var o,p;try{c=parseFloat(c),l=parseFloat(l),m=d(a,m),k=e(a,k),g=f(g),p=h(a.globalize.getLocale())}catch(q){return a.logger.error(q.message),a.translate(b.invalidInputTranslation)}return n||(c-=c*m),o=c*l,o-=o*k,this.getFormattedNumberWithAddition(a,o,g,i(p))},getTotalPricesAndTaxes:function(a,b,c,d){return b?n.call(this,a,b,c,d):null},getTotalFormattedPrice:function(a,b,c){var d=0,e=h(a.globalize.getLocale());return a&&b&&a.util.foreach(b,function(b){d+="string"==typeof b?a.parseFloat(b):b}.bind(this)),this.getFormattedNumberWithAddition(a,d,c,i(e))}}});