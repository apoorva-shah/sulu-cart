define(["suluproduct/util/locale-util"],function(a){"use strict";var b="#attribute-form";return{name:"Sulu Attribute Form",view:!0,templates:["/admin/product/template/attribute/form"],header:function(){return{toolbar:{languageChanger:{data:a.getProductLocalesForDropdown(),preSelected:this.options.locale},buttons:{save:{},"delete":{}}}}},initialize:function(){this.saved=!0,this.initializeValidation(),this.bindCustomEvents(),this.setHeaderBar(!0),this.render(),this.listenForChange()},bindCustomEvents:function(){this.sandbox.on("sulu.toolbar.save",function(){this.save()}.bind(this)),this.sandbox.on("sulu.toolbar.delete",function(){this.sandbox.emit("sulu.product.attributes.delete",this.sandbox.dom.val("#id"))}.bind(this)),this.sandbox.on("sulu.products.attributes.saved",function(a){this.options.data.id=a,this.setHeaderBar(!0)},this),this.sandbox.on("sulu.header.back",function(){this.sandbox.emit("sulu.product.attributes.list")},this)},initializeValidation:function(){this.sandbox.form.create(b)},save:function(){if(this.sandbox.form.validate(b)){var a=this.sandbox.form.getData(b);""===a.id&&delete a.id,a.type={id:1},this.sandbox.emit("sulu.product.attributes.save",a)}},render:function(){this.sandbox.dom.html(this.$el,this.renderTemplate("/admin/product/template/attribute/form")),this.valuesList=this.sandbox.dom.find("#attribute-values-list",this.$el),this.valuesList.addClass("hidden");var a=this.options.data.id,b="/admin/api/attributes/"+a+"/values?flat=true";this.sandbox.start([{name:"datagrid@husky",options:{el:this.sandbox.dom.find("#attribute-values-list",this.$el),url:b,pagination:!1,instanceName:"product-attributes",resultKey:"attributeValues",view:"table",matchings:"/admin/api/attributes/values/fields",contentFilters:{selected:"radio"},viewOptions:{table:{showHead:!0,editable:!0,validation:!0,fullWidth:!1},selectItem:{type:"checkbox",inFirstCell:!0}}}}]),this.initForm(this.options.data)},initForm:function(a){var c=this.sandbox.form.create(b);c.initialized.then(function(){this.setFormData(a)}.bind(this))},setFormData:function(a){this.sandbox.form.setData(b,a).then(function(){this.sandbox.start(b)}.bind(this)).fail(function(a){this.sandbox.logger.error("An error occured when setting data!",a)}.bind(this))},setHeaderBar:function(a){a!==this.saved&&(a?this.sandbox.emit("sulu.header.toolbar.item.disable","save",!0):this.sandbox.emit("sulu.header.toolbar.item.enable","save",!1)),this.saved=a},listenForChange:function(){this.sandbox.dom.on("#attribute-form","change",function(){this.setHeaderBar(!1)}.bind(this),"select"),this.sandbox.dom.on("#attribute-form","keyup",function(){this.setHeaderBar(!1)}.bind(this),"input, textarea"),this.sandbox.on("sulu.content.changed",function(){this.setHeaderBar(!1)}.bind(this)),this.sandbox.on("husky.select.attribute-types.selected.item",function(a){this.toggleValuesList(a),this.setHeaderBar(!1)}.bind(this))},toggleValuesList:function(a){}}});