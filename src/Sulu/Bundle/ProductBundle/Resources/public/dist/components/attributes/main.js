define(["suluproduct/models/attribute","app-config","suluproduct/util/locale-util"],function(a,b,c){"use strict";var d="sulu.product.attributes.",e=d+"new",f=d+"delete",g=d+"save",h=d+"list",i=d+"load";return{initialize:function(){this.attribute=null,this.bindCustomEvents(),"list"===this.options.display?this.renderList():"form"===this.options.display&&this.renderForm()},bindCustomEvents:function(){this.sandbox.on(e,function(a){this.newAttribute()}.bind(this)),this.sandbox.on(g,function(a){this.save(a)}.bind(this)),this.sandbox.on(f,function(a){"array"===this.sandbox.util.typeOf(a)?this.deleteAttributes(a):this.deleteAttribute(a)}.bind(this)),this.sandbox.on(h,function(){this.sandbox.emit("sulu.router.navigate","pim/attributes")}.bind(this)),this.sandbox.on("sulu.header.language-changed",function(a){this.load(this.options.id,a.title)},this),this.sandbox.on(i,function(a){this.load(a,c.retrieveDefaultLocale(this.sandbox))},this)},save:function(a){this.sandbox.emit("sulu.header.toolbar.item.loading","save"),this.attribute.set(a),this.attribute.saveLocale(this.options.locale,{success:function(b){var c=b.toJSON();a.id?this.sandbox.emit("sulu.products.attributes.saved",c):this.load(c.id,this.options.locale)}.bind(this),error:function(){this.sandbox.logger.log("error while saving attribute")}.bind(this)})},newAttribute:function(){this.sandbox.emit("sulu.router.navigate","pim/attributes/"+c.retrieveDefaultLocale(this.sandbox)+"/add")},deleteAttribute:function(b){return b||0==b?void this.showDeleteConfirmation(b,function(c){if(c){var d=a.findOrCreate({id:b});d.destroy({success:function(){this.sandbox.emit("sulu.router.navigate","pim/attributes")}.bind(this)})}}.bind(this)):void this.sandbox.emit("sulu.overlay.show-error","sulu.overlay.delete-no-items")},deleteAttributes:function(b){return b.length<1?void this.sandbox.emit("sulu.overlay.show-error","sulu.overlay.delete-no-items"):void this.showDeleteConfirmation(b,function(c,d){c&&b.forEach(function(b){var c=a.findOrCreate({id:b});c.destroy({data:{removeAttributes:!!d},processData:!0,success:function(){this.sandbox.emit("husky.datagrid.record.remove",b)}.bind(this)})}.bind(this))}.bind(this))},showDeleteConfirmation:function(a,b){0!==a.length&&this.sandbox.emit("sulu.overlay.show-warning","sulu.overlay.be-careful","sulu.overlay.delete-desc",b.bind(this,!1),b)},load:function(a,b){this.sandbox.emit("sulu.router.navigate","pim/attributes/"+b+"/edit:"+a+"/details")},renderForm:function(){this.attribute=new a;var b=this.sandbox.dom.createElement('<div id="attributes-form-container"/>'),c={name:"attributes/components/form@suluproduct",options:{el:b,locale:this.options.locale,data:this.attribute.defaults()}};this.html(b),this.options.id?(this.attribute.set({id:this.options.id}),this.attribute.fetchLocale(this.options.locale,{success:function(a){c.options.data=a.toJSON(),this.sandbox.start([c])}.bind(this)})):this.sandbox.start([c])},renderList:function(){var a=this.sandbox.dom.createElement('<div id="attributes-list-container"/>');this.html(a),this.sandbox.start([{name:"attributes/components/list@suluproduct",options:{el:a,locale:c.retrieveDefaultLocale(this.sandbox)}}])}}});